{% load static %}


<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>TOUR PAY</title>
    <link href="{% static 'css/styles.css' %}" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/simple-datatables@7.1.2/dist/style.min.css" rel="stylesheet" />
    <script src="https://use.fontawesome.com/releases/v6.3.0/js/all.js" crossorigin="anonymous"></script>
    <script src="js/jsQR.js"></script>
</head>


<body>
    <div class="login-wrapper">
        <div class="container">
            <div class="container-title">

                <p>QRì½”ë“œ ìŠ¤ìº”</p>
            </div>
            <hr style="border: solid 3px #888888">
            <p style="margin: -15px 0px 30px 0px; color: #888888;">ì¸ì†”ì/ê°€ì´ë“œê°€ ë³´ì—¬ì£¼ëŠ” QRì½”ë“œë¥¼ ì´¬ì˜í•˜ì„¸ìš”.</p>
            <div class="mt-3"></div>
            <div id="output">
                <div id="outputMessage">
                    QRì½”ë“œë¥¼ ì¹´ë©”ë¼ì— ë…¸ì¶œì‹œì¼œ ì£¼ì„¸ìš”
                </div>
                <div id="outputLayer" hidden>
                    <span id="outputData"></span>
                </div>
                <div id="frame">
                    <div id="loadingMessage">
                        ğŸ¥ ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ì— ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br />ì›¹ìº ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤
                    </div>
                    <canvas id="canvas"></canvas>
                </div>




                <div class="mt-3"></div>
                <input type="submit" value="ì €ì¥" class="submit-btn" onClick="location.href='../package'">
                </p>
            </div>
        </div>
</body>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        var video = document.createElement("video");
        var canvasElement = document.getElementById("canvas");
        var canvas = canvasElement.getContext("2d");
        var loadingMessage = document.getElementById("loadingMessage");
        var outputContainer = document.getElementById("output");
        var outputMessage = document.getElementById("outputMessage");
        var outputData = document.getElementById("outputData");

        function drawLine(begin, end, color) {
            canvas.beginPath();
            canvas.moveTo(begin.x, begin.y);
            canvas.lineTo(end.x, end.y);
            canvas.lineWidth = 4;
            canvas.strokeStyle = color;
            canvas.stroke();
        }

        // ì¹´ë©”ë¼ ì‚¬ìš©ì‹œ
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } }).then(function (stream) {
            video.srcObject = stream;
            video.setAttribute("playsinline", true);      // iOS ì‚¬ìš©ì‹œ ì „ì²´ í™”ë©´ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒì„ ì „ë‹¬
            video.play();
            requestAnimationFrame(tick);
        });

        function tick() {
            loadingMessage.innerText = "âŒ› ìŠ¤ìº” ê¸°ëŠ¥ì„ í™œì„±í™” ì¤‘ì…ë‹ˆë‹¤."
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                loadingMessage.hidden = true;
                canvasElement.hidden = false;
                outputContainer.hidden = false;

                // ì½ì–´ë“¤ì´ëŠ” ë¹„ë””ì˜¤ í™”ë©´ì˜ í¬ê¸°
                canvasElement.height = video.videoHeight;
                canvasElement.width = video.videoWidth;
                canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
                var imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
                var code = jsQR(imageData.data, imageData.width, imageData.height, {
                    inversionAttempts: "dontInvert",
                });

                // QRì½”ë“œ ì¸ì‹ì— ì„±ê³µí•œ ê²½ìš°
                if (code) {
                    // ì¸ì‹í•œ QRì½”ë“œì˜ ì˜ì—­ì„ ê°ì‹¸ëŠ” ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§€ëŠ” í…Œë‘ë¦¬ ìƒì„±
                    drawLine(code.location.topLeftCorner, code.location.topRightCorner, "#FF0000");
                    drawLine(code.location.topRightCorner, code.location.bottomRightCorner, "#FF0000");
                    drawLine(code.location.bottomRightCorner, code.location.bottomLeftCorner, "#FF0000");
                    drawLine(code.location.bottomLeftCorner, code.location.topLeftCorner, "#FF0000");
                    outputMessage.hidden = true;
                    outputData.parentElement.hidden = false;

                    // QRì½”ë“œ ë©”ì‹œì§€ ì¶œë ¥
                    outputData.innerHTML = code.data;
                    // returnì„ ì¨ì„œ í•¨ìˆ˜ë¥¼ ë¹ ì ¸ë‚˜ê°€ë©´ QRì½”ë“œ í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œëœë‹¤.
                    // return;
                }

                // QRì½”ë“œ ì¸ì‹ì— ì‹¤íŒ¨í•œ ê²½ìš° 
                else {
                    outputMessage.hidden = false;
                    outputData.parentElement.hidden = true;
                }
            }
            requestAnimationFrame(tick);
        }
    });
</script>


<style>
    .submit-btn {
        color: aliceblue;
        font-size: 16px;
        background-color: #2b8eff;
        margin: 30px 10px 0px 0px;
        padding: 10px;
        opacity: 1;
        border: none;
        border-radius: 6px;
        top: 459px;
        left: 16px;
        width: 100%;
        height: 52px;
    }

    .signup-btn {
        color: #2b8eff;
        font-size: 16px;
        background-color: #ffffff;
        margin: 5px 10px 10px 0px;
        opacity: 1;
        border-color: #2b8eff;
        border-width: 1px;
        border-radius: 6px;
        left: 16px;
        width: 100%;
        height: 52px;
    }

    #mb input::placeholder {
        color: #c3c4c6
    }

    .form-check-radio {
        display: block;
        min-height: 1.5rem;
        padding: 10px 5px 10px 20px;
        margin: 5px 2px 5px 2px;
        border: solid 1px #e1e3e6;
        border-radius: 5px;
    }

    body {
        font-family: 'Noto Sans KR', sans-serif;
    }

    .form-control {
        width: 100%;
        height: 50px;
        border: 0px solid transparent;
        border-radius: 6px;
        border: 1px solid #e1e3e6;
        padding: 1em;
        padding-left: 1em;
        outline: none;
    }

    .form__input {
        width: 100%;
        border: 0px solid transparent;
        border-radius: 0;
        border-bottom: 1px solid #e1e3e6;
        padding: 1em .5em .5em;
        padding-left: 1em;
        outline: none;
        margin: .5em auto;
        transition: all .5s ease;
    }

    .form__input:focus {
        border-bottom-color: #2b8eff;
        box-shadow: 0 0 5px rgba(0, 80, 80, .4);
        border-radius: 4px;
    }

    .login-wrapper {
        width: 100%;
        padding-left: 15px;
        padding-right: 15px;
        border: 0;
        border-radius: 5px;
        margin: 10px auto;
    }

    .login-wrapper>h2 {
        font-family: "Noto Sans KR", sans-serif !important;
        font-size: 24px;
        color: black;
        margin-bottom: 20px;
        text-align: center;
    }

    .login-wrapper>h3 {
        font-family: "Noto Sans KR", sans-serif !important;
        font-size: 16px;
        color: black;
        margin-bottom: 20px;
        text-align: center;
    }


    .container-title {
        font-family: "Noto Sans KR", sans-serif !important;
        font-size: 18px;
        font-weight: 700;
        text-align: center;
        width: 100%;
        padding-top: 10px;
        height: 40px;
        background: #FFFFFF 0% 0% no-repeat padding-box;
        opacity: 1;
    }


    .text {
        font-size: 14px;
        margin-bottom: 10px;
        border: none;
        border-radius: 5px;
        padding: 10px;
        width: 100%;
    }

    .link {
        text-align: center;
    }

    .link a {
        font-size: 12px;
        color: #9b9b9b;
    }

    .label {
        color: #999999;
        font-size: 13px;
    }
</style>